# –§–∏–Ω–∞–ª—å–Ω—ã–π –∞—É–¥–∏—Ç –ø—Ä–æ–µ–∫—Ç–∞ RixAI (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è NotebookLM)

–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª–æ–º: [add_to_NotebookLM](https://github.com/AndyShaman/add_to_NotebookLM)

---

## 1. –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–∏—Å–∫–∏

### 1.1 Background: –Ω–µ—Ç —Ç–∞–π–º–∞—É—Ç–∞ –¥–ª—è fetch (–æ—Ç–ª–∏—á–∏–µ –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞)

**–ì–¥–µ:** `background.js` ‚Äî –≤—Å–µ –≤—ã–∑–æ–≤—ã `fetch()` (getTokens, rpc, listAccounts).

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –æ—Ä–∏–≥–∏–Ω–∞–ª–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `fetchWithTimeout(url, options, 30000)`. –£ –Ω–∞—Å –≤—ã–∑–æ–≤—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–π `fetch`. –ü—Ä–∏ ¬´–∑–∞–≤–∏—Å–∞–Ω–∏–∏¬ª —Å–µ—Ä–≤–µ—Ä–∞ NotebookLM –∏–ª–∏ Google –∑–∞–ø—Ä–æ—Å –º–æ–∂–µ—Ç –≤–∏—Å–µ—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ, –±–ª–æ–∫–∏—Ä—É—è popup/–∫–æ–Ω—Ç–µ–Ω—Ç.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å —É—Ç–∏–ª–∏—Ç—É `fetchWithTimeout` –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—ë –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –≤–Ω–µ—à–Ω–∏–º –¥–æ–º–µ–Ω–∞–º (getTokens, rpc, listAccounts).

---

### 1.2 Background: regex –¥–ª—è listAccounts –º–æ–∂–µ—Ç –¥–∞—Ç—å –Ω–µ–≤–µ—Ä–Ω—ã–π match

**–ì–¥–µ:** `background.js`, —Å—Ç—Ä–æ–∫–∞ ~198:

```js
const match = text.match(/postMessage\('(.*)'\s*,\s*'https:/);
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –æ—Ä–∏–≥–∏–Ω–∞–ª–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `([^']*)` (–¥–æ –ø–µ—Ä–≤–æ–π –∫–∞–≤—ã—á–∫–∏). –£ –Ω–∞—Å `(.*)` ‚Äî –∂–∞–¥–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ. –ï—Å–ª–∏ –≤ —Ç–µ–ª–µ postMessage –µ—Å—Ç—å —Å—Ç—Ä–æ–∫–∞ —Å `'https:`, regex –º–æ–∂–µ—Ç –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –ª–∏—à–Ω–µ–µ, `match[1]` —Å—Ç–∞–Ω–µ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º JSON –∏ `JSON.parse(decoded)` –≤—ã–±—Ä–æ—Å–∏—Ç. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Å–ø–∏—Å–æ–∫ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –±—É–¥–µ—Ç –ø—É—Å—Ç—ã–º –±–µ–∑ —è–≤–Ω–æ–π –æ—à–∏–±–∫–∏ –≤ UI.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `postMessage\('([^']*)'\s*,\s*'https:` –∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ.

---

### 1.3 Background: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ handleMessage

**–ì–¥–µ:** `background.js`, switch –ø–æ `cmd`: –≤—ã–∑–æ–≤—ã `addSources(params.notebookId, params.urls)`, `deleteSources(params.notebookId, params.sourceIds)` –∏ –¥—Ä.

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ –ø–æ–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `{ cmd: 'add-sources' }`), —Ç–æ:
- `params.urls` ‚Äî `undefined` ‚Üí –≤ `addSources` –≤—ã–∑–æ–≤ `urls.map(...)` –¥–∞—Å—Ç TypeError;
- `params.sourceIds` ‚Äî `undefined` ‚Üí –≤ `deleteSources` –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ `sourceIds.length` / `sourceIds.slice` –¥–∞—Å—Ç TypeError.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í –Ω–∞—á–∞–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥, —Ç—Ä–µ–±—É—é—â–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏—Ö –Ω–∞–ª–∏—á–∏–µ –∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `{ error: 'Missing parameters' }` –≤–º–µ—Å—Ç–æ –≤—ã–∑–æ–≤–∞ API.

---

### 1.4 Popup: –ø–∞–¥–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ showSuccessWithActions(notebook)

**–ì–¥–µ:** `popup/popup.js` ‚Äî –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ add-source/add-sources –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `showSuccessWithActions(notebook, ‚Ä¶)`, –≥–¥–µ `notebook = notebooks.find(n => n.id === notebookId)`.

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –Ω–æ—É—Ç–±—É–∫ —É–¥–∞–ª—ë–Ω —Å –¥—Ä—É–≥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–ª–∏ —Å–ø–∏—Å–æ–∫ –Ω–µ –æ–±–Ω–æ–≤–ª—ë–Ω, `notebook` –º–æ–∂–µ—Ç –±—ã—Ç—å `undefined`. –¢–æ–≥–¥–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ `notebook.id`, `notebook.emoji`, `notebook.name` –≤ `showSuccessWithActions` –≤—ã–∑–æ–≤–µ—Ç TypeError –∏ –ø–ª–∞—à–∫–∞ —É—Å–ø–µ—Ö–∞ –Ω–µ –ø–æ–∫–∞–∂–µ—Ç—Å—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–æ–≤–µ—Ä—è—Ç—å `if (!notebook)` –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —É–ø—Ä–æ—â—ë–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ –∫–Ω–æ–ø–∫–∏ ¬´–û—Ç–∫—Ä—ã—Ç—å –Ω–æ—É—Ç–±—É–∫¬ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ª—å–∫–æ ¬´–î–æ–±–∞–≤–ª–µ–Ω–æ¬ª).

---

### 1.5 Popup: –≤–æ–∑–º–æ–∂–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤ detectYouTubePageType

**–ì–¥–µ:** `popup/popup.js`, `loadCurrentTab()` ‚Üí `detectYouTubePageType(currentTab.url)`.

**–ü—Ä–æ–±–ª–µ–º–∞:** –í–Ω—É—Ç—Ä–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `new URL(url)`. –î–ª—è –≤–∫–ª–∞–¥–æ–∫ —Å URL –≤—Ä–æ–¥–µ `chrome://extensions/`, `edge://settings/`, `about:blank` –∏–ª–∏ –±–∏—Ç–æ–π —Å—Ç—Ä–æ–∫–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä URL –º–æ–∂–µ—Ç –≤—ã–±—Ä–æ—Å–∏—Ç—å. –í–µ—Å—å `loadCurrentTab` –≤ try/catch, –Ω–æ –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (currentTab, currentUrlDiv) –º–æ–∂–µ—Ç –±—ã—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –û–±–µ—Ä–Ω—É—Ç—å –≤—ã–∑–æ–≤ `new URL(url)` –≤ try/catch –≤–Ω—É—Ç—Ä–∏ `detectYouTubePageType` –∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ –ø—Ä–æ—Å—Ç–æ –≤—ã—Ö–æ–¥–∏—Ç—å (–æ—Å—Ç–∞–≤–∏—Ç—å youtubePageType = null).

---

### 1.6 App (–º–∞—Å—Å–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç): XSS –≤ —Å–ø–∏—Å–∫–µ –Ω–æ—É—Ç–±—É–∫–æ–≤

**–ì–¥–µ:** `app/app.js`, —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ—É—Ç–±—É–∫–æ–≤ (~—Å—Ç—Ä–æ–∫–∞ 162):

```js
notebookSelect.innerHTML = notebooks.map(nb => `
  <option value="${nb.id}" ...>
    ${nb.emoji} ${nb.name} (${nb.sources} ${sourcesText})
  </option>
`).join('');
```

**–ü—Ä–æ–±–ª–µ–º–∞:** `nb.name` –∏ `nb.emoji` –ø–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ HTML –±–µ–∑ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è. –í –ø—Ä–æ–µ–∫—Ç–µ —É–∂–µ –µ—Å—Ç—å `escapeHtml()` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤–∫–ª–∞–¥–æ–∫). –ï—Å–ª–∏ –∏–º—è –Ω–æ—É—Ç–±—É–∫–∞ —Å–æ–∑–¥–∞–Ω–æ —Å —Ç–µ–≥–∞–º–∏ –∏–ª–∏ –∫–∞–≤—ã—á–∫–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä `"><script>‚Ä¶</script>`), –≤–æ–∑–º–æ–∂–µ–Ω XSS –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `escapeHtml(nb.name)` –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å emoji (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ textContent –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π escape –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞).

---

## 2. –£—è–∑–≤–∏–º–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 2.1 –¢–æ–∫–µ–Ω—ã NotebookLM

–¢–æ–∫–µ–Ω—ã (bl, at) —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏ service worker –∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö —Å `credentials: 'include'`. –í –∫–æ–¥–µ –æ–Ω–∏ –Ω–µ –ø–∏—à—É—Ç—Å—è –≤ storage –∏ –Ω–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è ‚Äî —ç—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–¥—Ö–æ–¥—É –æ—Ä–∏–≥–∏–Ω–∞–ª–∞.

### 2.2 host_permissions

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è `https://notebooklm.google.com/*`, `https://www.youtube.com/*`, `https://accounts.google.com/*`, `<all_urls>`. –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è; —Å—É–∂–µ–Ω–∏–µ –¥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—É—Ç–µ–π –ø—Ä–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–º–µ–Ω—å—à–∏–ª–æ –±—ã –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –∞—Ç–∞–∫–∏, –Ω–æ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é/—Ä–µ–¥–∏—Ä–µ–∫—Ç—ã.

### 2.3 Content script (notebooklm.js)

- –£–¥–∞–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–µ–ª–∞–µ—Ç—Å—è –ø–æ ID, –ø–æ–ª—É—á–µ–Ω–Ω—ã–º –∏–∑ DOM (—Å–µ–ª–µ–∫—Ç–æ—Ä—ã `.single-source-container`, `[id^="source-item-more-button-"]`). –ü–æ–¥–º–µ–Ω–∞ ID –≤–æ–∑–º–æ–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã NotebookLM ‚Äî –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –º–æ–¥–µ–ª–∏ —É–≥—Ä–æ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.
- –í `removeDeletedSourcesFromDOM` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `sourceId` –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä–µ –∏ –≤ `outerHTML.includes(sourceId)`. ID ‚Äî UUID, –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ —Å–µ–ª–µ–∫—Ç–æ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–∞; —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–º–æ–∂–µ–Ω –ª–æ–∂–Ω—ã–π match –ø–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–µ –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ‚Äî —Ä–∏—Å–∫ –Ω–∏–∑–∫–∏–π.

---

## 3. –û—Ç–ª–∏—á–∏—è –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª–∞ (–±–µ–∑ —è–≤–Ω—ã—Ö –±–∞–≥–æ–≤)

| –ê—Å–ø–µ–∫—Ç | –û—Ä–∏–≥–∏–Ω–∞–ª | RixAI |
|--------|----------|--------|
| fetch | fetchWithTimeout 30s | –û–±—ã—á–Ω—ã–π fetch |
| listAccounts regex | `([^']*)` | `(.*)` |
| –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é | ¬´üìî Send to NotebookLM¬ª | ¬´Send to RixAI¬ª |
| –£–¥–∞–ª–µ–Ω–∏–µ –≤ DOM | ‚Äî | –£–¥–∞–ª—è–µ–º —Å—Ç—Ä–æ–∫–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ (–¥–æ–ø. —Ñ–∏—á–∞) |
| –°—Ç–∏–ª—å –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è | –ü—Ä–æ–∑—Ä–∞—á–Ω—ã–π, –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π | –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π, –∫–∞–∫ –≤ –æ—Ç—á—ë—Ç–µ |
| –ü–ª–∞—à–∫–∞ —É—Å–ø–µ—Ö–∞ –≤ popup | textContent + createElement | innerHTML —Å –∫–Ω–æ–ø–∫–æ–π, display –¥–ª—è .status.success |

---

## 4. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫)

1. **background.js:** –≤–≤–µ—Å—Ç–∏ `fetchWithTimeout` –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è getTokens, rpc, listAccounts.
2. **background.js:** –≤ listAccounts –∑–∞–º–µ–Ω–∏—Ç—å regex –Ω–∞ `postMessage\('([^']*)'\s*,\s*'https:`.
3. **background.js:** –≤ handleMessage –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ `params.notebookId`, `params.urls`, `params.sourceIds` (–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π) –∏ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `{ error: 'Missing parameters' }`.
4. **popup/popup.js:** –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º `showSuccessWithActions(notebook, ‚Ä¶)` –ø—Ä–æ–≤–µ—Ä—è—Ç—å `if (!notebook)` –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å fallback-—Å–æ–æ–±—â–µ–Ω–∏–µ.
5. **popup/popup.js:** –≤ `detectYouTubePageType` –æ–±–µ—Ä–Ω—É—Ç—å `new URL(url)` –≤ try/catch.
6. **app/app.js:** –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ –Ω–æ—É—Ç–±—É–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `escapeHtml(nb.name)` (–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤—Å—Ç–∞–≤–ª—è—Ç—å emoji).

–ü–æ—Å–ª–µ —ç—Ç–∏—Ö –ø—Ä–∞–≤–æ–∫ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±—É–¥–µ—Ç –±–ª–∏–∂–µ –∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—É –∏ —É—Å—Ç–æ–π—á–∏–≤–µ–µ –∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –¥–∞–Ω–Ω—ã–º –∏ —Å–µ—Ç–µ–≤—ã–º —Å–±–æ—è–º.
